<!DOCTYPE html>
<html lang="en" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>POS System ‚Äì Login</title>

    <!-- Tailwind + SweetAlert -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            boxShadow: {
              glow: "0 0 25px rgba(79,70,229,0.4)",
            },
            animation: {
              gradient: "gradient 10s ease infinite",
            },
            keyframes: {
              gradient: {
                "0%, 100%": { backgroundPosition: "0% 50%" },
                "50%": { backgroundPosition: "100% 50%" },
              },
            },
          },
        },
      };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
      body {
        background: linear-gradient(-45deg, #6366f1, #ec4899, #3b82f6, #a855f7);
        background-size: 300% 300%;
        animation: gradient 10s ease infinite;
      }
      .dark body {
        background: linear-gradient(-45deg, #1e1b4b, #4c1d95, #312e81, #701a75);
        background-size: 300% 300%;
        animation: gradient 10s ease infinite;
      }
      .glass {
        backdrop-filter: blur(16px);
        background: rgba(255, 255, 255, 0.8);
      }
      .dark .glass {
        background: rgba(15, 23, 42, 0.6);
      }
    </style>
  </head>

  <body
    class="h-full flex items-center justify-center text-slate-800 dark:text-slate-100 transition-colors duration-300"
  >
    <main class="w-full max-w-md mx-auto p-6">
      <div
        class="glass rounded-3xl shadow-glow border border-slate-200 dark:border-slate-800 overflow-hidden relative"
      >
        <!-- Top bar with theme toggle -->
        <div class="absolute top-3 right-3">
          <button
            id="themeToggle"
            class="text-slate-500 dark:text-slate-200 hover:text-indigo-500 transition"
            title="Toggle dark/light"
          >
            üåô
          </button>
        </div>

        <div class="p-6 sm:p-8 mt-6">
          <!-- Logo -->
          <div class="flex items-center justify-center mb-6">
            <div
              class="h-14 w-14 rounded-2xl bg-gradient-to-br from-indigo-500 to-fuchsia-500 shadow-lg flex items-center justify-center text-white text-2xl font-bold"
            >
              üí≥
            </div>
          </div>

          <h1 class="text-2xl font-semibold text-center mb-2">
            Welcome to POS System
          </h1>
          <p
            class="text-center text-slate-500 dark:text-slate-400 mb-8 text-sm"
          >
            Sign in to manage sales, products, and reports.
          </p>

          <!-- Form -->
          <form id="loginForm" class="space-y-4">
            <div>
              <label class="block text-sm font-medium mb-1">Username</label>
              <input
                id="username"
                required
                class="w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                placeholder="admin"
              />
            </div>

            <div>
              <label class="block text-sm font-medium mb-1">Password</label>
              <div class="relative">
                <input
                  id="password"
                  type="password"
                  required
                  minlength="4"
                  class="w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 pr-10 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                  placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                />
                <button
                  type="button"
                  id="showPass"
                  class="absolute right-2 top-1/2 -translate-y-1/2 text-slate-500 dark:text-slate-300 hover:text-indigo-500"
                >
                  üëÅÔ∏è
                </button>
              </div>
            </div>

            <div class="flex items-center justify-between text-sm">
              <label class="inline-flex items-center gap-2">
                <input
                  id="rememberMe"
                  type="checkbox"
                  class="rounded border-slate-300 dark:border-slate-600"
                />
                Remember me
              </label>
              <span class="text-slate-400 text-xs">üí° Secure Login</span>
            </div>

            <button
              type="submit"
              class="w-full rounded-xl bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2.5 font-medium shadow-md shadow-indigo-500/20 transition"
            >
              Sign In
            </button>
          </form>

          <p
            class="text-center text-xs text-slate-500 dark:text-slate-400 mt-5"
          >
            Default:
            <code class="font-mono text-slate-700 dark:text-slate-300"
              >admin / 123456</code
            >
          </p>
        </div>
      </div>

      <footer
        class="text-xs text-center text-slate-500 dark:text-slate-400 mt-6"
      >
        ¬© 2025 Baxsane POS ‚Ä¢ Step 1 of 8
      </footer>
    </main>

    <script>
      const $ = (s, c = document) => c.querySelector(s);
      const DB_KEYS = {
        users: "pos_users_v1",
        session: "pos_session_v1",
        theme: "pos_theme",
      };

      // Theme toggle
      function applyTheme() {
        const dark = localStorage.getItem(DB_KEYS.theme) === "dark";
        document.documentElement.classList.toggle("dark", dark);
        $("#themeToggle").textContent = dark ? "‚òÄÔ∏è" : "üåô";
      }
      applyTheme();

      $("#themeToggle").addEventListener("click", () => {
        const mode =
          localStorage.getItem(DB_KEYS.theme) === "dark" ? "light" : "dark";
        localStorage.setItem(DB_KEYS.theme, mode);
        applyTheme();
      });

      // Show Password toggle üëÅÔ∏è
      $("#showPass").addEventListener("click", () => {
        const pass = $("#password");
        if (pass.type === "password") {
          pass.type = "text";
          $("#showPass").textContent = "üôà";
        } else {
          pass.type = "password";
          $("#showPass").textContent = "üëÅÔ∏è";
        }
      });

      // Seed default user
      function seedUser() {
        let users = JSON.parse(localStorage.getItem(DB_KEYS.users) || "[]");
        if (!users.length) {
          users.push({
            id: "U-0001",
            username: "admin",
            password: btoa("123456"),
            role: "Admin",
          });
          localStorage.setItem(DB_KEYS.users, JSON.stringify(users));
        }
      }
      seedUser();

      // Login (works with both encoded & plain passwords)
      $("#loginForm").addEventListener("submit", (e) => {
        e.preventDefault();

        const username = $("#username").value.trim();
        const password = $("#password").value.trim();
        const users = JSON.parse(localStorage.getItem(DB_KEYS.users) || "[]");
        const user = users.find(
          (u) => u.username.toLowerCase() === username.toLowerCase()
        );

        function decodeSafe(str) {
          try {
            return atob(str);
          } catch {
            return str;
          }
        }

        if (!user || decodeSafe(user.password) !== password) {
          Swal.fire({
            icon: "error",
            title: "Login failed",
            text: "Incorrect username or password",
            confirmButtonColor: "#4f46e5",
          });
          return;
        }

        const session = {
          username: user.username,
          role: user.role,
          loginAt: Date.now(),
        };
        localStorage.setItem(DB_KEYS.session, JSON.stringify(session));

        Swal.fire({
          icon: "success",
          title: "Welcome back, " + user.username,
          timer: 1000,
          showConfirmButton: false,
        }).then(() => {
          window.location.href = "dashboard.html";
        });
      });
    </script>
  </body>
</html>
